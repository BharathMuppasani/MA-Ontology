<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ontology Based Explainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-container::-webkit-scrollbar {
            width: 4px;
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="flex h-screen">
        <!-- Left Side: Chatbot -->
        <div class="w-full md:w-2/5 lg:w-1/3 xl:w-1/4 bg-white border-r border-slate-200 flex flex-col h-screen">
            <div class="p-4 border-b border-slate-200">
                <h2 class="text-xl font-semibold text-slate-700">MA Explainer</h2>
                <p class="text-sm text-slate-500">Ask a question to get an explanation.</p>
            </div>
            <div id="chat-container" class="flex-1 p-4 overflow-y-auto chat-container">
                <!-- Chat messages will be appended here -->
                <div class="flex items-start gap-3 mb-4">
                    <div class="bg-slate-200 p-2 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                    </div>
                    <div>
                        <div class="bg-slate-200 p-3 rounded-lg max-w-xs">
                            <p class="text-sm">Hello! I'm here to help. Ask me something about the ontology, for example: "What are the subclasses of 'Person'?"</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-slate-200">
                <div class="flex items-center bg-slate-100 rounded-lg">
                    <input type="text" id="chat-input" placeholder="Type your message..." class="w-full bg-transparent p-3 focus:outline-none text-sm text-slate-700">
                    <button id="send-btn" class="p-3 text-slate-500 hover:text-slate-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Side: Tabbed Views -->
        <div class="w-full md:w-3/5 lg:w-2/3 xl:w-3/4 flex flex-col bg-slate-50 h-screen">
            <div class="p-2 border-b border-slate-200 bg-white">
                <div class="flex space-x-1">
                    <button class="tab-btn active-tab" data-tab="ontology-view">Ontology Viewer</button>
                    <button class="tab-btn" data-tab="sparql-view">SPARQL Results</button>
                </div>
            </div>
            <div class="flex-1 p-6 overflow-y-auto">
                <!-- Ontology View -->
                <div id="ontology-view" class="tab-content">
                    <h3 class="text-lg font-semibold mb-4 text-slate-700">Ontology Visualization</h3>
                    <div class="bg-white p-6 rounded-lg border border-slate-200">
                        <!-- <p class="text-slate-500 mb-4">This is a placeholder for your ontology visualization. You can integrate a library like <a href="https://d3js.org/" target="_blank" class="text-blue-500 hover:underline">D3.js</a> or a specific ontology viewer to display your data here.</p> -->
                        <!-- Example of a simple tree structure -->
                        <div class="text-sm text-slate-600">
                            <ul class="space-y-2">
                                <li>
                                    <span class="font-semibold">Thing</span>
                                    <ul class="pl-5 mt-1 space-y-1 border-l border-slate-200">
                                        <li><span class="font-semibold">Person</span>
                                            <ul class="pl-5 mt-1 space-y-1 border-l border-slate-200">
                                                <li>Student</li>
                                                <li>Professor</li>
                                            </ul>
                                        </li>
                                        <li><span class="font-semibold">Document</span>
                                            <ul class="pl-5 mt-1 space-y-1 border-l border-slate-200">
                                                <li>Paper</li>
                                                <li>Book</li>
                                            </ul>
                                        </li>
                                         <li><span class="font-semibold">Event</span>
                                            <ul class="pl-5 mt-1 space-y-1 border-l border-slate-200">
                                                <li>Conference</li>
                                                <li>Workshop</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- SPARQL View -->
                <div id="sparql-view" class="tab-content hidden">
                    <h3 class="text-lg font-semibold mb-4 text-slate-700">SPARQL Query Results</h3>
                     <div id="sparql-query-display" class="bg-gray-800 text-white p-4 rounded-lg mb-4 font-mono text-sm">
                        <p class="text-gray-400">// SPARQL query will be shown here based on your chat</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg border border-slate-200">
                        <div id="sparql-table-container" class="overflow-x-auto">
                           <p class="text-slate-500">Results from SPARQL queries will be displayed in a table here.</p>
                           <!-- Table will be generated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .tab-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: #475569; /* slate-600 */
            background-color: transparent;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .tab-btn:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .tab-btn.active-tab {
            color: #0f172a; /* slate-900 */
            background-color: #f1f5f9; /* slate-100 */
            border-color: #e2e8f0; /* slate-200 */
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            const chatContainer = document.getElementById('chat-container');
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const sparqlQueryDisplay = document.getElementById('sparql-query-display');
            const sparqlTableContainer = document.getElementById('sparql-table-container');

            // --- Tab Switching Logic ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all tabs
                    tabs.forEach(t => t.classList.remove('active-tab'));
                    tabContents.forEach(c => c.classList.add('hidden'));

                    // Activate clicked tab
                    tab.classList.add('active-tab');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });

            // --- Chat Logic ---
            const handleSendMessage = () => {
                const message = chatInput.value.trim();
                if (message) {
                    addMessageToChat('user', message);
                    chatInput.value = '';
                    simulateBotResponse(message);
                }
            };

            sendBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            });

            function addMessageToChat(sender, text) {
                const messageDiv = document.createElement('div');
                if (sender === 'user') {
                    messageDiv.className = 'flex items-start gap-3 mb-4 justify-end';
                    messageDiv.innerHTML = `
                        <div>
                            <div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">
                                <p class="text-sm">${text}</p>
                            </div>
                        </div>
                         <div class="bg-blue-500 p-2 rounded-full text-white">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                    `;
                } else {
                    messageDiv.className = 'flex items-start gap-3 mb-4';
                    messageDiv.innerHTML = `
                        <div class="bg-slate-200 p-2 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                        </div>
                        <div>
                            <div class="bg-slate-200 p-3 rounded-lg max-w-xs">
                                <p class="text-sm">${text}</p>
                            </div>
                        </div>
                    `;
                }
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight; // Auto-scroll to bottom
            }

            function simulateBotResponse(userMessage) {
                 setTimeout(() => {
                    let botReply = "I'm not sure how to respond to that. Try asking about 'Person' subclasses.";
                    let sparqlQuery = ``;
                    let sparqlData = null;

                    if (userMessage.toLowerCase().includes("subclasses of 'person'")) {
                        botReply = "Certainly. Here are the subclasses of 'Person'. I've also run a SPARQL query to fetch these results, which you can see in the 'SPARQL Results' tab.";
                        sparqlQuery = `
PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
SELECT ?subclass
WHERE {
  ?subclass rdfs:subClassOf &lt;http://example.org/ontology#Person&gt; .
}`;
                        sparqlData = {
                            headers: ["subclass"],
                            rows: [
                                ["http://example.org/ontology#Student"],
                                ["http://example.org/ontology#Professor"]
                            ]
                        };
                    } else if (userMessage.toLowerCase().includes("papers by professors")) {
                         botReply = "Of course. Here is a list of papers authored by professors. The results are in the SPARQL tab.";
                         sparqlQuery = `
PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
PREFIX ex: &lt;http://example.org/ontology#&gt;
SELECT ?paper ?authorName
WHERE {
  ?paper rdf:type ex:Paper .
  ?paper ex:hasAuthor ?author .
  ?author rdf:type ex:Professor .
  ?author ex:hasName ?authorName .
}`;
                        sparqlData = {
                            headers: ["paper", "authorName"],
                            rows: [
                                ["ex:Paper101", "Dr. Alan Turing"],
                                ["ex:Paper102", "Dr. Grace Hopper"]
                            ]
                        };
                    }


                    addMessageToChat('bot', botReply);
                    if(sparqlData) {
                        displaySparqlResults(sparqlQuery, sparqlData);
                        // Switch to SPARQL tab
                        document.querySelector('.tab-btn[data-tab="sparql-view"]').click();
                    }
                }, 1000);
            }

            function displaySparqlResults(query, data) {
                 // Display query
                sparqlQueryDisplay.innerHTML = `<pre><code>${query.trim()}</code></pre>`;

                // Display table
                sparqlTableContainer.innerHTML = ''; // Clear previous results
                const table = document.createElement('table');
                table.className = 'w-full text-sm text-left text-slate-500';

                const thead = document.createElement('thead');
                thead.className = 'text-xs text-slate-700 uppercase bg-slate-100';
                let headerHtml = '<tr>';
                data.headers.forEach(header => {
                    headerHtml += `<th scope="col" class="px-6 py-3">${header}</th>`;
                });
                headerHtml += '</tr>';
                thead.innerHTML = headerHtml;

                const tbody = document.createElement('tbody');
                data.rows.forEach(row => {
                    let rowHtml = '<tr class="bg-white border-b">';
                    row.forEach(cell => {
                        rowHtml += `<td class="px-6 py-4">${cell}</td>`;
                    });
                    rowHtml += '</tr>';
                    tbody.innerHTML += rowHtml;
                });

                table.appendChild(thead);
                table.appendChild(tbody);
                sparqlTableContainer.appendChild(table);
            }
        });
    </script>

</body>
</html>
